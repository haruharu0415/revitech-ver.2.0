<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>お知らせ一覧 | 生徒用</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .news-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
        .card-title {
            font-weight: 700;
            color: #333;
        }
    </style>
</head>
<body>

    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>📰 お知らせ一覧</h1>
            
            <a th:href="@{/news/register}" class="btn btn-primary" th:if="${canRegister}">
                <i class="bi bi-pencil-square"></i> 新規登録
            </a>
        </div>
        
        <div class="row row-cols-1 g-4">
            
            <div class="col" th:each="news : ${newsList}">
                <div class="card news-card shadow-sm border-0">
                    <div class="card-body">
                        <h5 class="card-title text-primary" th:text="${news.title}">お知らせのタイトル</h5>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <span th:if="${news.recipientUserIds != null and news.recipientUserIds.size() > 0}" 
                                      class="badge bg-success me-2">
                                    <i class="bi bi-people-fill"></i> 受信者: <span th:text="${news.recipientUserIds.size()}">10</span>名
                                </span>
                                
                                <span class="badge bg-info text-dark me-2">
                                    <i class="bi bi-clock"></i> 
                                    投稿: <span th:text="${#temporals.format(news.newsDatetime, 'yyyy/MM/dd HH:mm')}">2025/11/11 13:00</span>
                                </span>
                                
                                <span class="badge bg-info text-dark">
                                    <i class="bi bi-person-fill"></i> 送信者: 
                                    <span th:text="${news.sender != null ? news.sender.name : 'ID:' + news.senderId}">送信者名</span>
                                </span>
                            </div>
                        </div>
                        
                        <div th:if="${news.images != null and !news.images.isEmpty()}" class="mb-3">
                            <div class="ratio ratio-16x9 border rounded overflow-hidden" style="max-width: 400px; background-color: #f8f9fa;">
                                <img th:src="@{'data:' + ${news.images[0].contentType} + ';base64,' + ${news.images[0].imageData}}" 
                                     style="object-fit: contain;" 
                                     alt="添付画像">
                            </div>
                            <div class="mt-1" th:if="${news.images.size() > 1}">
                                <span class="badge bg-secondary">
                                    <i class="bi bi-images"></i> 他 <span th:text="${news.images.size() - 1}">1</span> 枚の画像
                                </span>
                            </div>
                        </div>
                        
                        <p class="card-text text-muted" 
                           th:text="${#strings.length(news.newsBody) > 100 ? #strings.substring(news.newsBody, 0, 100) + '...' : news.newsBody}">
                            お知らせの本文の冒頭部分。長い場合は省略されます。
                        </p>
                    </div> 
                    <div class="card-footer bg-light text-end">
                        <a th:href="@{/news/{id}(id=${news.newsId})}" class="btn btn-sm btn-outline-primary">
                            詳細を見る
                        </a>
                    </div>
                </div> 
            </div>
            
            <div class="col-12" th:if="${newsList.isEmpty()}">
                <div class="alert alert-info text-center" role="alert">
                    現在、登録されているお知らせはありません。
                </div>
            </div>
            
        </div>
        
        <div class="mt-4 text-center">
            <a th:href="@{/home}" class="btn btn-outline-secondary">ホームに戻る</a>
        </div>
        
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN74b9t+g" 
            crossorigin="anonymous"></script>
</body>
</html>